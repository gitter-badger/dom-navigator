/*! dom-navigator - v1.0.1 - 2014-08-19
* https://github.com/rmariuzzo/dom-navigator
* Copyright (c) 2014 Rubens Mariuzzo; Licensed MIT */
!function(a){"function"==typeof define&&define.amd?define([],function(){return a(window.jQuery)}):a(window.jQuery)}(function(a){function b(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a}function c(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function d(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")}function e(a){return a.jquery||Array.isArray(a)?a[0]:a}function f(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=window.innerHeight&&b.right<=window.innerWidth}var g=function(a,c){this.$doc=window.document,this.$container=a,this.$options=b({},g.defaults,c),this.init()},h={left:"left",up:"up",right:"right",down:"down"},i={auto:"auto",horizontal:"horizontal",vertical:"vertical",grid:"grid"};if(g.defaults={mode:i.auto,selected:"selected",left:37,up:38,right:39,down:40,cols:0},g.prototype.init=function(){if(this.validateOptions(),this.$selected=null,this.$keydownHandler=null,this.$keys={},this.$keys[this.$options.left]=this.left,this.$keys[this.$options.up]=this.up,this.$keys[this.$options.right]=this.right,this.$keys[this.$options.down]=this.down,this.$options.mode===i.grid&&!this.$options.cols){for(var a=this.elements(),b=[],c=0;c<a.length&&!(c>0&&b[c-1]!==a[c].offsetTop);c++)b[c]=a[c].offsetTop;this.$options.cols=b.length}this.enable()},g.prototype.validateOptions=function(){var a=!1;for(var b in i)a=a||this.$options.mode===i[b];if(!a)throw new Error("Unsupported navigation mode: "+this.$options.mode)},g.prototype.enable=function(){var a=this;this.$keydownHandler=function(b){a.handleKeydown.call(a,b)},this.$doc.addEventListener("keydown",this.$keydownHandler)},g.prototype.disable=function(){this.$keydownHandler&&this.$doc.removeEventListener("keydown",this.$keydownHandler)},g.prototype.destroy=function(){this.disable(),this.$container.domNavigator&&delete this.$container.domNavigator},g.prototype.left=function(){var a=null;switch(this.$options.mode){case i.auto:if(!this.$selected){a=this.elements()[0];break}var b=this.$selected.offsetLeft-1,c=this.$selected.offsetTop;a=this.elementsBefore(b,1/0).reduce(function(a,d){var e=Math.abs(b-d.offsetLeft)+Math.abs(c-d.offsetTop);return e<a.distance?{distance:e,element:d}:a},{distance:1/0}),a=a.element;break;case i.horizontal:if(!this.$selected){a=this.elements()[0];break}a=this.$selected.previousElementSibling;break;case i.vertical:break;case i.grid:if(!this.$selected){a=this.elements()[0];break}var d=this.elements().indexOf(this.$selected);d%this.$options.cols!==0&&(a=this.$selected.previousElementSibling)}this.select(a,h.left)},g.prototype.up=function(){var a=null;switch(this.$options.mode){case i.auto:if(!this.$selected){a=this.elements()[0];break}var b=this.$selected.offsetLeft,c=this.$selected.offsetTop-1;a=this.elementsBefore(1/0,c).reduce(function(a,d){var e=Math.abs(b-d.offsetLeft)+Math.abs(c-d.offsetTop);return e<a.distance?{distance:e,element:d}:a},{distance:1/0}),a=a.element;break;case i.horizontal:break;case i.vertical:if(!this.$selected){a=this.elements()[0];break}a=this.$selected.previousElementSibling;break;case i.grid:if(!this.$selected){a=this.elements()[0];break}a=this.$selected;for(var d=0;d<this.$options.cols;d++)a=a&&a.previousElementSibling}this.select(a,h.up)},g.prototype.right=function(){var a=null;switch(this.$options.mode){case i.auto:if(!this.$selected){a=this.elements()[0];break}var b=this.$selected.offsetLeft+this.$selected.offsetWidth,c=this.$selected.offsetTop;a=this.elementsAfter(b,0).reduce(function(a,d){var e=Math.abs(d.offsetLeft-b)+Math.abs(d.offsetTop-c);return e<a.distance?{distance:e,element:d}:a},{distance:1/0}),a=a.element;break;case i.horizontal:if(!this.$selected){a=this.elements()[0];break}a=this.$selected.nextElementSibling;break;case i.vertical:break;case i.grid:if(!this.$selected){a=this.elements()[0];break}var d=this.elements().indexOf(this.$selected);(0===d||(d+1)%this.$options.cols!==0)&&(a=this.$selected.nextElementSibling)}this.select(a,h.right)},g.prototype.down=function(){var a=null;switch(this.$options.mode){case i.auto:if(!this.$selected){a=this.elements()[0];break}var b=this.$selected.offsetLeft,c=this.$selected.offsetTop+this.$selected.offsetHeight;a=this.elementsAfter(0,c).reduce(function(a,d){var e=Math.abs(d.offsetLeft-b)+Math.abs(d.offsetTop-c);return e<a.distance?{distance:e,element:d}:a},{distance:1/0}),a=a.element;break;case i.horizontal:break;case i.vertical:if(!this.$selected){a=this.elements()[0];break}a=this.$selected.nextElementSibling;break;case i.grid:if(!this.$selected){a=this.elements()[0];break}a=this.$selected;for(var d=0;d<this.$options.cols;d++)a=a&&a.nextElementSibling}this.select(a,h.down)},g.prototype.selected=function(){return this.$selected},g.prototype.select=function(a,b){a&&a!==this.$selected&&(a=e(a),this.$selected&&d(this.$selected,this.$options.selected),this.scrollTo(a,b),c(a,this.$options.selected),this.$selected=a)},g.prototype.scrollTo=function(a,b){if(a=e(a),this.inContainerViewport(a)){if(!f(a))switch(b){case h.left:document.body.scrollLeft=a.offsetLeft-document.body.offsetLeft;break;case h.up:document.body.scrollTop=a.offsetTop-document.body.offsetTop;break;case h.right:document.body.scrollLeft=a.offsetLeft-document.body.offsetLeft-(document.documentElement.clientWidth-a.offsetWidth);break;case h.down:document.body.scrollTop=a.offsetTop-document.body.offsetTop-(document.documentElement.clientHeight-a.offsetHeight)}}else switch(b){case h.left:this.$container.scrollLeft=a.offsetLeft-this.$container.offsetLeft;break;case h.up:this.$container.scrollTop=a.offsetTop-this.$container.offsetTop;break;case h.right:this.$container.scrollLeft=a.offsetLeft-this.$container.offsetLeft-(this.$container.offsetWidth-a.offsetWidth);break;case h.down:this.$container.scrollTop=a.offsetTop-this.$container.offsetTop-(this.$container.offsetHeight-a.offsetHeight)}},g.prototype.inContainerViewport=function(a){return a=e(a),a.offsetLeft-this.$container.scrollLeft<this.$container.offsetLeft?!1:a.offsetTop-this.$container.scrollTop<this.$container.offsetTop?!1:a.offsetLeft+a.offsetWidth-this.$container.scrollLeft>this.$container.offsetLeft+this.$container.offsetWidth?!1:a.offsetTop+a.offsetHeight-this.$container.scrollTop>this.$container.offsetTop+this.$container.offsetHeight?!1:!0},g.prototype.elements=function(){for(var a=[],b=this.$container.children.length;b--;)8!==this.$container.children[b].nodeType&&a.unshift(this.$container.children[b]);return a},g.prototype.elementsAfter=function(a,b){return this.elements().filter(function(c){return c.offsetLeft>=a&&c.offsetTop>=b})},g.prototype.elementsBefore=function(a,b){return this.elements().filter(function(c){return c.offsetLeft<=a&&c.offsetTop<=b})},g.prototype.handleKeydown=function(a){this.$keys[a.which]&&(a.preventDefault(),this.$keys[a.which].call(this))},window.DomNavigator=g,a){var j=a.fn.domNavigator;a.fn.domNavigator=function(a){var b,c=Array.prototype.slice.call(arguments,1);return this.each(function(){this.domNavigator||(this.domNavigator=new g(this,"object"==typeof a&&a)),"string"==typeof a&&this.domNavigator[a]&&(b=this.domNavigator[a].apply(this.domNavigator,c))}),void 0===b&&(b=this),b},a.fn.domNavigator.Constructor=g,a.fn.domNavigator.noConflict=function(){return a.fn.domNavigator=j,this}}});